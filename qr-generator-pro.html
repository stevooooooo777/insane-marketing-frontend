<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 Custom QR Generator Pro</title>
   <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
<script src="/config-client.js"></script>
<script>
  window.addEventListener('load', async () => {
    const user = CONFIG.getAuthenticatedUser();
    const analytics = await CONFIG.makeApiCall(`/analytics/${user.restaurantId}`);
    document.getElementById('total-scans').textContent = analytics.totalScans || 0;
  });
</script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
       
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
       
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
       
        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }
       
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
       
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
       
        .free-trial-banner {
            background: linear-gradient(45deg, #00d2ff, #3a7bd5);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
            animation: pulse 2s infinite;
        }
       
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
       
        .content {
            padding: 40px;
        }
       
        .steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
       
        .step {
            flex: 1;
            text-align: center;
            padding: 20px;
            margin: 10px;
            background: #f8f9fa;
            border-radius: 15px;
            min-width: 150px;
            cursor: pointer;
            transition: all 0.3s;
        }
       
        .step.active {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            transform: scale(1.05);
        }
       
        .step.completed {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
        }
       
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
        }
       
        .step.active .step-number, .step.completed .step-number {
            background: white;
            color: #0984e3;
        }
       
        .step-content {
            display: none;
        }
       
        .step-content.active {
            display: block;
        }
       
        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
       
        .form-group {
            margin-bottom: 20px;
        }
       
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
       
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
       
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #74b9ff;
        }
       
        .qr-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
       
        .qr-type-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
       
        .qr-type-card:hover {
            border-color: #74b9ff;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
       
        .qr-type-card.selected {
            border-color: #00b894;
            background: #e8f5e8;
        }
       
        .qr-type-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }
       
        .color-picker-section {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
       
        .color-group {
            flex: 1;
            min-width: 200px;
        }
       
        .color-presets {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
       
        .color-preset {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
       
        .color-preset:hover, .color-preset.selected {
            border-color: #333;
            transform: scale(1.1);
        }
       
        .qr-preview {
            width: 200px;
            height: 200px;
            background: white;
            border: 3px solid #e9ecef;
            border-radius: 15px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            position: relative;
            overflow: hidden;
        }
       
        .qr-preview canvas {
            border-radius: 10px;
        }
       
        .qr-preview.loading {
            font-size: 16px;
            color: #666;
        }
       
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-decoration: none;
            text-align: center;
            margin: 5px;
        }
       
        .btn-primary {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }
       
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
       
        .btn-success {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
        }
       
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
       
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
       
        .summary-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
       
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
        }
       
        .summary-item.total {
            border-top: 2px solid #e9ecef;
            margin-top: 15px;
            padding-top: 15px;
            font-weight: bold;
            font-size: 1.2em;
        }
       
        .free-trial-pricing {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
       
        .generated-section {
            display: none;
            text-align: center;
            padding: 30px;
            background: #e8f5e8;
            border-radius: 15px;
            margin-top: 20px;
        }
       
        .generated-section.show {
            display: block;
        }
       
        .download-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
       
        .download-btn {
            padding: 10px;
            background: white;
            border: 2px solid #74b9ff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
       
        .download-btn:hover {
            background: #74b9ff;
            color: white;
        }
       
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
       
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }
       
        .sme-helper {
            background: #e8f5e8; 
            padding: 20px; 
            border-radius: 10px; 
            margin: 20px 0; 
            border-left: 4px solid #00b894;
        }
       
        .message-preview {
            margin-top: 15px; 
            padding: 15px; 
            background: white; 
            border-radius: 8px; 
            border: 2px solid #e9ecef; 
            display: none;
        }
       
        @media (max-width: 768px) {
            .steps {
                flex-direction: column;
            }
           
            .step {
                margin: 5px 0;
            }
           
            .header h1 {
                font-size: 2em;
            }
           
            .content {
                padding: 20px;
            }
           
            .color-picker-section {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 Custom QR Generator Pro</h1>
            <p>Create dynamic, trackable QR codes with advanced analytics</p>
        </div>
       
        <div class="free-trial-banner">
            🎉 FREE 15-Day Trial for Small & Medium Enterprises! No Credit Card Required!
        </div>
       
        <div class="content">
            <div class="steps">
                <div class="step active" onclick="goToStep(1)">
                    <div class="step-number">1</div>
                    <div>Choose Type</div>
                </div>
                <div class="step" onclick="goToStep(2)">
                    <div class="step-number">2</div>
                    <div>Set Up</div>
                </div>
                <div class="step" onclick="goToStep(3)">
                    <div class="step-number">3</div>
                    <div>Customize</div>
                </div>
                <div class="step" onclick="goToStep(4)">
                    <div class="step-number">4</div>
                    <div>Generate</div>
                </div>
            </div>
           
            <!-- Step 1: Choose QR Type -->
            <div class="step-content active" id="step1">
                <div class="form-section">
                    <h2>📱 Choose Your QR Code Type</h2>
                    <div class="qr-type-grid">
                        <div class="qr-type-card" onclick="selectQRType('website')">
                            <span class="qr-type-icon">🌐</span>
                            <h3>Website URL</h3>
                            <p>Direct users to your website or landing page</p>
                        </div>
                        <div class="qr-type-card" onclick="selectQRType('vcard')">
                            <span class="qr-type-icon">👤</span>
                            <h3>Contact Card</h3>
                            <p>Share your contact information instantly</p>
                        </div>
                        <div class="qr-type-card" onclick="selectQRType('wifi')">
                            <span class="qr-type-icon">📶</span>
                            <h3>WiFi Network</h3>
                            <p>Let customers connect to your WiFi easily</p>
                        </div>
                        <div class="qr-type-card" onclick="selectQRType('menu')">
                            <span class="qr-type-icon">🍽️</span>
                            <h3>Digital Menu</h3>
                            <p>Perfect for restaurants and cafes</p>
                        </div>
                        <div class="qr-type-card" onclick="selectQRType('social')">
                            <span class="qr-type-icon">📱</span>
                            <h3>Social Media</h3>
                            <p>Link to your social profiles</p>
                        </div>
                        <div class="qr-type-card" onclick="selectQRType('email')">
                            <span class="qr-type-icon">✉️</span>
                            <h3>Email</h3>
                            <p>Pre-compose emails for customers</p>
                        </div>
                        <div class="qr-type-card" onclick="selectQRType('sms')">
                            <span class="qr-type-icon">💬</span>
                            <h3>SMS/Text</h3>
                            <p>Send pre-written text messages</p>
                        </div>
                        <div class="qr-type-card" onclick="selectQRType('app')">
                            <span class="qr-type-icon">📲</span>
                            <h3>App Download</h3>
                            <p>Direct to app store downloads</p>
                        </div>
                    </div>
                </div>
               
                <div class="navigation">
                    <div></div>
                    <button class="btn btn-primary" onclick="nextStep()">Continue to Setup →</button>
                </div>
            </div>
           
            <!-- Step 2: Set Up Content -->
            <div class="step-content" id="step2">
                <div class="form-section">
                    <h2>⚙️ Set Up Your QR Code</h2>
                    <div id="setup-form">
                        <!-- Dynamic form will load here based on QR type -->
                    </div>
                </div>
               
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
                    <button class="btn btn-primary" onclick="nextStep()">Continue to Customize →</button>
                </div>
            </div>
           
            <!-- Step 3: Customize Design -->
            <div class="step-content" id="step3">
                <div class="form-section">
                    <h2>🎨 Customize Your QR Code Design</h2>
                   
                    <div class="form-group">
                        <label>QR Code Name</label>
                        <input type="text" id="qr-name" placeholder="e.g., Business Landing Page" value="Business Landing Page">
                    </div>
                   
                    <div class="form-group">
                        <label>Campaign Name</label>
                        <input type="text" id="campaign-name" placeholder="e.g., Summer Promotion 2025" value="Summer Promotion 2025">
                    </div>
                   
                    <!-- SME Business Message Helper -->
                    <div class="sme-helper">
                        <h4 style="color: #00b894; margin-bottom: 15px;">🚀 SME Quick Messages</h4>
                        <p style="margin-bottom: 15px; color: #666;">Choose what customers will see when they scan your QR code:</p>
                       
                        <div class="form-group">
                            <label>Business Message (What's this QR for?)</label>
                            <select id="business-message" onchange="updateBusinessMessage()" style="margin-bottom: 10px;">
                                <option value="">Choose a professional message...</option>
                             <br>   <optgroup label="🍽️ Restaurant & Food">
                                    <option value="Scan for our digital menu">🍽️ Scan for our digital menu</option>
                                    <option value="View today's specials">🌟 View today's specials</option>
                                    <option value="Happy hour deals inside!">🍻 Happy hour deals inside!</option>
                                    <option value="Order online for pickup">🚗 Order online for pickup</option>
                                    <option value="Book your table now">📅 Book your table now</option>
                                </optgroup>
                               <br> <optgroup label="🛍️ Retail & Shopping">
                                    <option value="Exclusive offer - Scan now!">🎉 Exclusive offer - Scan now!</option>
                                    <option value="Get 15% off your purchase">💰 Get 15% off your purchase</option>
                                    <option value="Join our loyalty program">🎯 Join our loyalty program</option>
                                    <option value="View our latest collection">👗 View our latest collection</option>
                                    <option value="Check product details">📋 Check product details</option>
                                </optgroup>
                            <br>    <optgroup label="🏨 Hospitality & Services">
                                    <option value="Free WiFi for guests">📶 Free WiFi for guests</option>
                                    <option value="Rate your experience">⭐ Rate your experience</option>
                                    <option value="View our services">💼 View our services</option>
                                    <option value="Book your appointment">📅 Book your appointment</option>
                                    <option value="Get directions to us">🗺️ Get directions to us</option>
                                </optgroup>
                            <br>    <optgroup label="💪 Health & Fitness">
                                    <option value="Start your free trial">🆓 Start your free trial</option>
                                    <option value="View class schedules">📅 View class schedules</option>
                                    <option value="Book your session">🏋️ Book your session</option>
                                    <option value="Health & safety info">🛡️ Health & safety info</option>
                                </optgroup>
                           <br>     <optgroup label="📱 Digital & Social">
                                    <option value="Follow us on social media">📱 Follow us on social media</option>
                                    <option value="Download our mobile app">📲 Download our mobile app</option>
                                    <option value="Subscribe to our newsletter">📧 Subscribe to our newsletter</option>
                                    <option value="Share your feedback">💬 Share your feedback</option>
                                </optgroup>
                           <br>     <optgroup label="📞 Contact & Info">
                                    <option value="Get our contact details">📞 Get our contact details</option>
                                    <option value="Save our business card">💳 Save our business card</option>
                                    <option value="View opening hours">🕒 View opening hours</option>
                                    <option value="Emergency contact info">🚨 Emergency contact info</option>
                                </optgroup>
                            </select>
                           
                            <input type="text" id="custom-message" placeholder="✏️ Or write your own custom message..." style="margin-top: 10px; border: 2px dashed #00b894;">
                           
                            <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 5px; font-size: 0.9em;">
                                <strong>💡 Pro Tip:</strong> Keep your message short and action-oriented. Tell customers exactly what they'll get when they scan!
                            </div>
                        </div>
                       
                        <div class="message-preview" id="message-preview">
                            <strong>Preview:</strong> <span id="preview-text"></span>
                        </div>
                    </div>
                   
                    <div class="color-picker-section">
                        <div class="color-group">
                            <label>Foreground Color</label>
                            <input type="color" id="fg-color" value="#000000" onchange="updateQRColors()">
                            <div class="color-presets">
                                <div class="color-preset" style="background: #000000" onclick="setColor('fg', '#000000')"></div>
                                <div class="color-preset" style="background: #2d3436" onclick="setColor('fg', '#2d3436')"></div>
                                <div class="color-preset" style="background: #e17055" onclick="setColor('fg', '#e17055')"></div>
                                <div class="color-preset" style="background: #0984e3" onclick="setColor('fg', '#0984e3')"></div>
                                <div class="color-preset" style="background: #00b894" onclick="setColor('fg', '#00b894')"></div>
                                <div class="color-preset" style="background: #6c5ce7" onclick="setColor('fg', '#6c5ce7')"></div>
                                <div class="color-preset" style="background: #a29bfe" onclick="setColor('fg', '#a29bfe')"></div>
                                <div class="color-preset" style="background: #fd79a8" onclick="setColor('fg', '#fd79a8')"></div>
                            </div>
                        </div>
                       
                        <div class="color-group">
                            <label>Background Color</label>
                            <input type="color" id="bg-color" value="#ffffff" onchange="updateQRColors()">
                            <div class="color-presets">
                                <div class="color-preset" style="background: #ffffff; border: 1px solid #ddd" onclick="setColor('bg', '#ffffff')"></div>
                                <div class="color-preset" style="background: #f8f9fa" onclick="setColor('bg', '#f8f9fa')"></div>
                                <div class="color-preset" style="background: #e9ecef" onclick="setColor('bg', '#e9ecef')"></div>
                                <div class="color-preset" style="background: #fff3cd" onclick="setColor('bg', '#fff3cd')"></div>
                                <div class="color-preset" style="background: #d1ecf1" onclick="setColor('bg', '#d1ecf1')"></div>
                                <div class="color-preset" style="background: #d4edda" onclick="setColor('bg', '#d4edda')"></div>
                                <div class="color-preset" style="background: #f8d7da" onclick="setColor('bg', '#f8d7da')"></div>
                                <div class="color-preset" style="background: #e2e3e5" onclick="setColor('bg', '#e2e3e5')"></div>
                            </div>
                        </div>
                    </div>
                   
                    <div class="form-group">
                        <label>Size</label>
                        <select id="qr-size">
                            <option value="small">Small (300x300)</option>
                            <option value="medium" selected>Medium (600x600)</option>
                            <option value="large">Large (1200x1200)</option>
                        </select>
                    </div>
                   
                    <div class="qr-preview" id="qr-preview">
                        <div style="font-size: 16px; color: #666;">QR will appear here</div>
                    </div>
                   
                    <button class="btn btn-primary" onclick="generatePreview()" style="margin-top: 20px;">🔄 Update QR Preview</button>
                </div>
               
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
                    <button class="btn btn-primary" onclick="nextStep()">Review & Generate →</button>
                </div>
            </div>
           
            <!-- Step 4: Review & Generate -->
            <div class="step-content" id="step4">
                <div class="form-section">
                    <h2>📋 QR Code Summary</h2>
                    <div class="summary-card">
                        <div class="summary-item">
                            <span><strong>Type:</strong></span>
                            <span id="summary-type">Website URL</span>
                        </div>
                        <div class="summary-item">
                            <span><strong>Name:</strong></span>
                            <span id="summary-name">Business Landing Page</span>
                        </div>
                        <div class="summary-item">
                            <span><strong>Campaign:</strong></span>
                            <span id="summary-campaign">Summer Promotion 2025</span>
                        </div>
                        <div class="summary-item">
                            <span><strong>Content:</strong></span>
                            <span id="summary-content">Will be displayed here</span>
                        </div>
                    </div>
                   
                    <div class="qr-preview" id="qr-preview-step4">
                        <div style="font-size: 16px; color: #666;">Final QR Preview</div>
                    </div>
                </div>
               
                <!-- Free Trial Option -->
                <div class="free-trial-pricing">
                    <h3>🆓 15-Day Free Trial (SME Package)</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="free-trial" checked>
                        <label for="free-trial">Activate FREE 15-day trial (Perfect for Small & Medium Enterprises)</label>
                    </div>
                    <div class="summary-item">
                        <span>QR Code Generation:</span>
                        <span>FREE</span>
                    </div>
                    <div class="summary-item">
                        <span>Analytics Tracking (15 days):</span>
                        <span>FREE</span>
                    </div>
                    <div class="summary-item">
                        <span>Premium Features Access:</span>
                        <span>FREE</span>
                    </div>
                    <div class="summary-item total">
                        <span>Trial Total:</span>
                        <span>£0.00</span>
                    </div>
                    <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                        After 15 days, continue with our SME plan at £9.99/month or upgrade anytime.
                    </p>
                </div>
               
                <div style="text-align: center; margin: 30px 0;">
                    <button class="btn btn-success" onclick="generateFinalQR()">
                        🎯 Start Free Trial & Generate QR Code
                    </button>
                </div>

                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
                    <div></div>
                </div>
            </div>
           
            <!-- Generated QR Section -->
            <div class="generated-section" id="generated-section">
                <h2>🎉 QR Generated Successfully!</h2>
               
                <div class="qr-preview" id="final-qr-preview" style="width: 250px; height: 250px; margin: 30px auto;">
                    <div style="font-size: 16px; color: #666;">Your QR Code</div>
                </div>
               
                <div class="summary-card">
                    <div class="summary-item">
                        <span><strong>QR Code ID:</strong></span>
                        <span id="generated-id">qr_trial_55r3j1xpx</span>
                    </div>
                    <div class="summary-item">
                        <span><strong>Campaign Name:</strong></span>
                        <span id="generated-campaign">Summer Promotion 2025</span>
                    </div>
                    <div class="summary-item">
                        <span><strong>[Internal code]:</strong></span>
                        <span id="generated-url">https://insane.marketing/track/qr_trial_55r3j1xpx</span>
                    </div>

                    <div class="summary-item">
                        <span><strong>Trial Status:</strong></span>
                        <span style="color: #00b894; font-weight: bold;">Active (14 days remaining)</span>
                    </div>
                </div>
               
                <h3>📥 Download Options</h3>
                <div class="download-options">
                    <div class="download-btn" onclick="downloadQR('png-small')">
                        <strong>PNG Small</strong><br>300x300
                    </div>
                    <div class="download-btn" onclick="downloadQR('png-medium')">
                        <strong>PNG Medium</strong><br>600x600
                    </div>
                    <div class="download-btn" onclick="downloadQR('png-large')">
                        <strong>PNG Large</strong><br>1200x1200
                    </div>
                </div>
               
                <div style="margin-top: 30px;">
                    <button class="btn btn-primary" onclick="viewAnalytics()">📊 View Analytics Dashboard</button>
                </div>
               
                <div style="margin-top: 20px;">                    
                    <button class="btn btn-primary" onclick="editQR()">✏️ Edit/Update</button>
                    <button class="btn btn-primary" onclick="createAnother()">➕ Create Another</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentStep = 1;
        let selectedQRType = '';
        let currentQRCanvas = null;

        // QR Content Builder
        function buildQRContent() {
            let content = '';
            
            switch (selectedQRType) {
                case 'website':
                    content = document.getElementById('website-url')?.value || 'https://example.com';
                    break;
                   
                case 'vcard':
                    const name = document.getElementById('vcard-name')?.value || 'John Doe';
                    const phone = document.getElementById('vcard-phone')?.value || '';
                    const email = document.getElementById('vcard-email')?.value || '';
                    const company = document.getElementById('vcard-company')?.value || '';
                    content = `BEGIN:VCARD\nVERSION:3.0\nFN:${name}\nORG:${company}\nTEL:${phone}\nEMAIL:${email}\nEND:VCARD`;
                    break;
                   
                case 'wifi':
                    const ssid = document.getElementById('wifi-ssid')?.value || 'MyWiFi';
                    const password = document.getElementById('wifi-password')?.value || '';
                    const security = document.getElementById('wifi-security')?.value || 'WPA';
                    content = `WIFI:T:${security};S:${ssid};P:${password};;`;
                    break;
                   
                case 'menu':
                    content = document.getElementById('menu-url')?.value || 'https://yourmenu.com';
                    break;
                   
                case 'social':
                    content = document.getElementById('social-url')?.value || 'https://instagram.com/yourbusiness';
                    break;
                   
                case 'email':
                    const emailAddr = document.getElementById('email-address')?.value || 'contact@business.com';
                    const subject = document.getElementById('email-subject')?.value || 'Inquiry';
                    const body = document.getElementById('email-body')?.value || '';
                    content = `mailto:${emailAddr}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                    break;
                   
                case 'sms':
                    const smsNumber = document.getElementById('sms-number')?.value || '+0234567890';
                    const message = document.getElementById('sms-message')?.value || '';
                    content = `sms:${smsNumber}?body=${encodeURIComponent(message)}`;
                    break;
                   
                case 'app':
                    const iosUrl = document.getElementById('app-ios')?.value;
                    const androidUrl = document.getElementById('app-android')?.value;
                    content = iosUrl || androidUrl || 'https://apps.apple.com/app/yourapp';
                    break;
                   
                default:
                    content = 'https://insane.marketing/demo';
            }
            
            return content;
        }

        // Generate QR Code        
function generateQRCode(targetElementId, size = 180) {
    const targetElement = document.getElementById(targetElementId);
    const content = buildQRContent();
    
    if (!content || !selectedQRType) {
        targetElement.innerHTML = '<div style="font-size: 16px; color: #666;">Please select a QR type and enter content</div>';
        return;
    }

    targetElement.innerHTML = '<div style="font-size: 16px; color: #666;">Generating QR...</div>';

    try {
        const canvas = document.createElement('canvas');
        const qr = new QRious({
            element: canvas,
            value: content,
            size: size,
            background: document.getElementById('bg-color')?.value || '#ffffff',
            foreground: document.getElementById('fg-color')?.value || '#000000'
        });
        
        targetElement.innerHTML = '';
        targetElement.appendChild(canvas);
        currentQRCanvas = canvas;
        console.log('QR generated successfully');
        
    } catch (error) {
        console.error('QR Generation Error:', error);
        targetElement.innerHTML = '<div style="font-size: 16px; color: #e74c3c;">QR generation failed: ' + error.message + '</div>';
    }
}


        // Manual QR Preview Generation
        function generatePreview() {
            generateQRCode('qr-preview', 180);
        }

        // QR Type Selection
        function selectQRType(type) {
            selectedQRType = type;
            
            // Remove previous selections
            document.querySelectorAll('.qr-type-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked card
            event.currentTarget.classList.add('selected');
        }

        // Step Navigation
        function goToStep(step) {
            if (step <= currentStep || document.querySelector(`.step:nth-child(${step})`).classList.contains('completed')) {
                showStep(step);
            }
        }

        function nextStep() {
            if (currentStep === 1 && !selectedQRType) {
                alert('Please select a QR code type first!');
                return;
            }
            
            if (currentStep < 4) {
                // Mark current step as completed
                document.querySelector(`.step:nth-child(${currentStep})`).classList.add('completed');
                document.querySelector(`.step:nth-child(${currentStep})`).classList.remove('active');
                
                currentStep++;
                showStep(currentStep);
                
                if (currentStep === 2) {
                    loadSetupForm();
                } else if (currentStep === 4) {
                    updateSummary();
                    generateQRCode('qr-preview-step4', 180);
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                document.querySelector(`.step:nth-child(${currentStep})`).classList.remove('active');
                currentStep--;
                showStep(currentStep);
            }
        }

        function showStep(step) {
            // Hide all step contents
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show selected step content
            document.getElementById(`step${step}`).classList.add('active');
            
            // Update step indicators
            document.querySelectorAll('.step').forEach((stepEl, index) => {
                stepEl.classList.remove('active');
                if (index + 1 === step) {
                    stepEl.classList.add('active');
                }
            });
            
            currentStep = step;
        }

        // Load Setup Form
        function loadSetupForm() {
            const setupForm = document.getElementById('setup-form');
            let formHTML = '';
            
            switch (selectedQRType) {
                case 'website':
                    formHTML = `
                        <div class="form-group">
                            <label>Website URL</label>
                            <input type="url" id="website-url" placeholder="https://your-website.com" value="https://example.com">
                        </div>
                        <div class="form-group">
                            <label>Page Title (Optional)</label>
                            <input type="text" id="page-title" placeholder="Your Business Name">
                        </div>
                    `;
                    break;
                case 'vcard':
                    formHTML = `
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="vcard-name" placeholder="John Doe" value="John Doe">
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" id="vcard-phone" placeholder="0234 567890" value="0234 567890">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="vcard-email" placeholder="john@example.com" value="john@example.com">
                        </div>
                        <div class="form-group">
                            <label>Company</label>
                            <input type="text" id="vcard-company" placeholder="Your Company Ltd" value="Your Company Ltd">
                        </div>
                    `;
                    break;
                case 'wifi':
                    formHTML = `
                        <div class="form-group">
                            <label>Network Name (SSID)</label>
                            <input type="text" id="wifi-ssid" placeholder="YourWiFiName" value="BusinessWiFi">
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="text" id="wifi-password" placeholder="password123" value="password123">
                        </div>
                        <div class="form-group">
                            <label>Security Type</label>
                            <select id="wifi-security">
                                <option value="WPA">WPA/WPA2</option>
                                <option value="WEP">WEP</option>
                                <option value="nopass">No Password</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'menu':
                    formHTML = `
                        <div class="form-group">
                            <label>Menu URL</label>
                            <input type="url" id="menu-url" placeholder="https://your-menu.com" value="https://yourmenu.com">
                        </div>
                        <div class="form-group">
                            <label>Restaurant Name</label>
                            <input type="text" id="restaurant-name" placeholder="Your Restaurant" value="Your Restaurant">
                        </div>
                    `;
                    break;
                case 'social':
                    formHTML = `
                        <div class="form-group">
                            <label>Social Media URL</label>
                            <input type="url" id="social-url" placeholder="https://instagram.com/yourbusiness" value="https://instagram.com/yourbusiness">
                        </div>
                        <div class="form-group">
                            <label>Platform</label>
                            <select id="social-platform">
                                <option value="instagram">Instagram</option>
                                <option value="facebook">Facebook</option>
                                <option value="twitter">Twitter</option>
                                <option value="linkedin">LinkedIn</option>
                                <option value="tiktok">TikTok</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'email':
                    formHTML = `
                        <div class="form-group">
                            <label>Email Address</label>
                            <input type="email" id="email-address" placeholder="contact@business.com" value="contact@business.com">
                        </div>
                        <div class="form-group">
                            <label>Subject</label>
                            <input type="text" id="email-subject" placeholder="Inquiry from QR Code" value="Inquiry from QR Code">
                        </div>
                        <div class="form-group">
                            <label>Pre-filled Message (Optional)</label>
                            <textarea id="email-body" placeholder="Hello, I'm interested in...">Hello, I'm interested in ...</textarea>
                        </div>
                    `;
                    break;
                case 'sms':
                    formHTML = `
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" id="sms-number" placeholder="0234 567890" value="0234 567890">
                        </div>
                        <div class="form-group">
                            <label>Pre-filled Message (Optional)</label>
                            <textarea id="sms-message" placeholder="Hello, I'm interested in...">Hello, I'm interested in ...</textarea>
                        </div>
                    `;
                    break;
                case 'app':
                    formHTML = `
                        <div class="form-group">
                            <label>iOS App Store URL</label>
                            <input type="url" id="app-ios" placeholder="https://apps.apple.com/app/yourapp" value="https://apps.apple.com/app/yourapp">
                        </div>
                        <div class="form-group">
                            <label>Google Play Store URL</label>
                            <input type="url" id="app-android" placeholder="https://play.google.com/store/apps/details?id=yourapp">
                        </div>
                    `;
                    break;
            }
            
            setupForm.innerHTML = formHTML;
        }

        // Color Functions
        function setColor(type, color) {
            if (type === 'fg') {
                document.getElementById('fg-color').value = color;
            } else {
                document.getElementById('bg-color').value = color;
            }
            updateQRColors();
        }

        function updateQRColors() {
            // Regenerate QR with new colors if we're on step 3
            if (currentStep >= 3 && currentQRCanvas) {
                generateQRCode('qr-preview', 180);
            }
        }

        // Business Message Functions
        function updateBusinessMessage() {
            const select = document.getElementById('business-message');
            const customInput = document.getElementById('custom-message');
            const preview = document.getElementById('message-preview');
            const previewText = document.getElementById('preview-text');
            
            if (select.value) {
                customInput.value = select.value;
                previewText.textContent = select.value;
                preview.style.display = 'block';
            }
        }

        // Summary Functions
        function updateSummary() {
            document.getElementById('summary-type').textContent = selectedQRType.charAt(0).toUpperCase() + selectedQRType.slice(1);
            document.getElementById('summary-name').textContent = document.getElementById('qr-name').value;
            document.getElementById('summary-campaign').textContent = document.getElementById('campaign-name').value;
            document.getElementById('summary-content').textContent = buildQRContent();
        }

        // Final Generation
        function generateFinalQR() {
            generateQRCode('final-qr-preview', 200);
            
            // Update generated info
            const randomId = 'qr_trial_' + Math.random().toString(36).substr(2, 9);
            document.getElementById('generated-id').textContent = randomId;
            document.getElementById('generated-campaign').textContent = document.getElementById('campaign-name').value;
            document.getElementById('generated-url').textContent = `https://insane.marketing/track/${randomId}`;
            
            // Show generated section
            document.getElementById('generated-section').classList.add('show');
            document.getElementById('step4').classList.remove('active');
        }

        // Download Functions
        function downloadQR(format) {
            if (!currentQRCanvas) {
                alert('Please generate a QR code first!');
                return;
            }
            
            const fileName = `${document.getElementById('qr-name').value.replace(/[^a-z0-9]/gi, '_').toLowerCase()}_qr`;
            
            let dimension;
            switch (format) {
                case 'png-small': dimension = 300; break;
                case 'png-large': dimension = 1200; break;
                default: dimension = 600;
            }
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = dimension;
            canvas.height = dimension;
            
            // Fill background
            const bgColor = document.getElementById('bg-color')?.value || '#ffffff';
            ctx.fillStyle = bgColor;
            ctx.fillRect(0, 0, dimension, dimension);
            
            // Draw QR code
            ctx.drawImage(currentQRCanvas, 0, 0, dimension, dimension);
            
            // Download
            const link = document.createElement('a');
            link.download = `${fileName}_${dimension}x${dimension}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        // Utility Functions
        function copyURL() {
            const url = document.getElementById('generated-url').textContent;
            navigator.clipboard.writeText(url).then(() => {
                alert('URL copied to clipboard!');
            });
        }

        function testQR() {
            const url = buildQRContent();
            window.open(url, '_blank');
        }

        function shareQR() {
            if (navigator.share) {
                navigator.share({
                    title: 'My QR Code',
                    url: document.getElementById('generated-url').textContent
                });
            } else {
                alert('Sharing feature not supported in this browser. Use copy URL instead.');
            }
        }

        function viewAnalytics() {
            alert('Analytics dashboard coming soon!');
        }

        function editQR() {
            document.getElementById('generated-section').classList.remove('show');
            showStep(3);
        }

        function createAnother() {
            selectedQRType = '';
            currentStep = 1;
            currentQRCanvas = null;
            document.getElementById('generated-section').classList.remove('show');
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('completed');
            });
            document.querySelectorAll('.qr-type-card').forEach(card => {
                card.classList.remove('selected');
            });
            showStep(1);
        }


// ALSO generatePreview function with this simpler version:

function generatePreview() {
    console.log('generatePreview called with QRious library');
    
    const targetElement = document.getElementById('qr-preview');
    if (!targetElement) {
        console.error('qr-preview element not found');
        return;
    }
    
    const content = buildQRContent();
    console.log('Content to encode:', content);
    
    if (!content || !selectedQRType) {
        targetElement.innerHTML = '<div style="font-size: 16px; color: #666;">Please select a QR type first</div>';
        return;
    }
    
    targetElement.innerHTML = '<div style="font-size: 16px; color: #666;">Generating...</div>';
    
    try {
        // Create QR code using QRious library (different syntax)
        const canvas = document.createElement('canvas');
        const qr = new QRious({
            element: canvas,
            value: content,
            size: 180,
            background: document.getElementById('bg-color')?.value || '#ffffff',
            foreground: document.getElementById('fg-color')?.value || '#000000'
        });
        
        console.log('QR generated successfully with QRious!');
        targetElement.innerHTML = '';
        targetElement.appendChild(canvas);
        currentQRCanvas = canvas;
        
    } catch (e) {
        console.error('QR generation exception:', e);
        targetElement.innerHTML = '<div style="color: red;">Failed: ' + e.message + '</div>';
    }
}







        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('QR Generator loaded');
            
            // Custom message input listener
            const customMessageInput = document.getElementById('custom-message');
            if (customMessageInput) {
                customMessageInput.addEventListener('input', function() {
                    const preview = document.getElementById('message-preview');
                    const previewText = document.getElementById('preview-text');
                    
                    if (this.value) {
                        previewText.textContent = this.value;
                        preview.style.display = 'block';
                    } else {
                        preview.style.display = 'none';
                    }
                });
            }
        });




    </script>
</body>
</html>


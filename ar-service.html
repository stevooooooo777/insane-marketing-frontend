<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Service Request - shuush.vip</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #D4AF37;
            --gold-light: #F4E4C1;
            --gold-dark: #B8942C;
            --navy: #0A1628;
            --navy-light: #1a2f4a;
            --slate: #2C3E50;
            --cream: #FAF7F2;
            --shadow-lg: 0 20px 60px rgba(10, 22, 40, 0.3);
            --shadow-xl: 0 30px 80px rgba(10, 22, 40, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--navy);
            color: var(--cream);
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        /* Camera View */
        #camera-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: none;
        }

        #camera-container.active {
            display: block;
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Elegant overlay gradient */
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                to bottom,
                rgba(10, 22, 40, 0.4) 0%,
                transparent 20%,
                transparent 80%,
                rgba(10, 22, 40, 0.8) 100%
            );
            pointer-events: none;
        }

        /* Refined crosshair */
        .location-marker {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            pointer-events: none;
        }

        .marker-ring {
            position: absolute;
            inset: 0;
            border: 2px solid var(--gold);
            border-radius: 50%;
            opacity: 0;
            animation: markerPulse 2s ease-out infinite;
        }

        .marker-ring:nth-child(2) { animation-delay: 0.5s; }
        .marker-ring:nth-child(3) { animation-delay: 1s; }

        @keyframes markerPulse {
            0% {
                transform: scale(0.5);
                opacity: 1;
            }
            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }

        .marker-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            background: var(--gold);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.6);
        }

        /* Location info card */
        .location-info {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(10, 22, 40, 0.85);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 16px;
            padding: 16px 20px;
            pointer-events: auto;
        }

        .location-status {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.875rem;
            font-weight: 300;
            letter-spacing: 0.5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--gold);
            border-radius: 50%;
            animation: breathe 2s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.4; transform: scale(0.8); }
        }

        .coords {
            font-size: 0.75rem;
            opacity: 0.6;
            margin-top: 6px;
            font-family: 'Courier New', monospace;
        }

        /* Bottom sheet - category selection */
        .bottom-sheet {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to bottom, rgba(10, 22, 40, 0.95), rgba(10, 22, 40, 0.98));
            backdrop-filter: blur(40px) saturate(180%);
            border-top-left-radius: 32px;
            border-top-right-radius: 32px;
            transform: translateY(100%);
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: auto;
            max-height: 70vh;
            overflow-y: auto;
            box-shadow: 0 -10px 60px rgba(0, 0, 0, 0.5);
        }

        .bottom-sheet.visible {
            transform: translateY(0);
        }

        .sheet-handle {
            width: 40px;
            height: 4px;
            background: rgba(212, 175, 55, 0.3);
            border-radius: 2px;
            margin: 12px auto 20px;
        }

        .sheet-content {
            padding: 0 20px 32px;
        }

        .sheet-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5rem;
            font-weight: 300;
            text-align: center;
            margin-bottom: 6px;
            color: var(--gold);
            letter-spacing: 1px;
        }

        .sheet-subtitle {
            text-align: center;
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 20px;
            font-weight: 300;
        }

        /* Category grid */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .category-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(212, 175, 55, 0.15);
            border-radius: 16px;
            padding: 20px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .category-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, rgba(212, 175, 55, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .category-card:active::before {
            opacity: 1;
        }

        .category-card:active {
            transform: scale(0.95);
            border-color: var(--gold);
            box-shadow: 0 8px 24px rgba(212, 175, 55, 0.2);
        }

        .category-icon {
            font-size: 2.2rem;
            margin-bottom: 8px;
            filter: grayscale(20%);
        }

        .category-name {
            font-size: 0.9rem;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        /* Recommendations view */
        .recommendations-view {
            display: none;
            animation: slideInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .recommendations-view.visible {
            display: block;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .back-button {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            color: var(--gold);
            font-size: 0.875rem;
            padding: 8px 0;
            cursor: pointer;
            margin-bottom: 20px;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        .context-banner {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(212, 175, 55, 0.05));
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .context-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.7;
            margin-bottom: 4px;
        }

        .context-value {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            color: var(--gold);
        }

        .section-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            opacity: 0.6;
            margin: 24px 0 12px;
            font-weight: 600;
        }

        .recommendation-card {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(212, 175, 55, 0.15);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .recommendation-card:active {
            transform: scale(0.98);
            background: rgba(212, 175, 55, 0.1);
            border-color: var(--gold);
        }

        .recommendation-card.selected {
            background: rgba(212, 175, 55, 0.15);
            border-color: var(--gold);
        }

        .rec-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 6px;
        }

        .rec-name {
            font-weight: 600;
            font-size: 0.95rem;
            letter-spacing: 0.3px;
        }

        .rec-badge {
            background: var(--gold);
            color: var(--navy);
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 6px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .rec-reason {
            font-size: 0.8rem;
            opacity: 0.7;
            font-weight: 300;
        }

        /* Details form */
        .details-form {
            margin-top: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.7;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-input, .form-textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 10px;
            padding: 12px 16px;
            color: var(--cream);
            font-size: 0.95rem;
            font-family: 'Montserrat', sans-serif;
            transition: all 0.3s;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--gold);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
            font-weight: 300;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .qty-btn {
            width: 40px;
            height: 40px;
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 10px;
            color: var(--gold);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qty-btn:active {
            transform: scale(0.9);
            background: rgba(212, 175, 55, 0.2);
        }

        .qty-value {
            flex: 1;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 300;
            font-family: 'Cormorant Garamond', serif;
        }

        /* Dietary tags */
        .dietary-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .dietary-tag {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 400;
        }

        .dietary-tag.selected {
            background: var(--gold);
            color: var(--navy);
            border-color: var(--gold);
        }

        /* Timing selector */
        .timing-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .timing-btn {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 10px;
            padding: 14px;
            color: var(--cream);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 400;
        }

        .timing-btn.selected {
            background: rgba(212, 175, 55, 0.15);
            border-color: var(--gold);
            color: var(--gold);
        }

        .time-input {
            grid-column: 1 / -1;
            margin-top: 8px;
        }

        /* Primary action button */
        .primary-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            border: none;
            border-radius: 14px;
            padding: 18px;
            color: var(--navy);
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            margin-top: 32px;
            transition: all 0.3s;
            box-shadow: 0 8px 24px rgba(212, 175, 55, 0.3);
        }

        .primary-btn:active {
            transform: scale(0.98);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
        }

        .primary-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* Start screen */
        .start-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(165deg, var(--navy) 0%, var(--navy-light) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            text-align: center;
        }

        .start-logo {
            width: 80px;
            height: 80px;
            background: var(--gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin-bottom: 32px;
            box-shadow: 0 20px 60px rgba(212, 175, 55, 0.3);
        }

        .start-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.5rem;
            font-weight: 300;
            color: var(--gold);
            margin-bottom: 16px;
            letter-spacing: 2px;
        }

        .start-subtitle {
            font-size: 1rem;
            font-weight: 300;
            opacity: 0.8;
            line-height: 1.6;
            max-width: 400px;
            margin-bottom: 48px;
        }

        .start-btn {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            border: none;
            border-radius: 50px;
            padding: 18px 48px;
            color: var(--navy);
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s;
        }

        .start-btn:active {
            transform: scale(0.95);
        }

        .permission-note {
            margin-top: 32px;
            font-size: 0.75rem;
            opacity: 0.5;
            max-width: 350px;
        }

        /* Confirmation screen */
        .confirmation-screen {
            position: fixed;
            inset: 0;
            background: rgba(10, 22, 40, 0.98);
            backdrop-filter: blur(40px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 40px;
        }

        .confirmation-screen.active {
            display: flex;
            animation: fadeIn 0.4s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .confirmation-content {
            text-align: center;
            max-width: 400px;
        }

        .check-circle {
            width: 100px;
            height: 100px;
            background: var(--gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 32px;
            font-size: 3rem;
            animation: scaleIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes scaleIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        .confirm-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem;
            color: var(--gold);
            margin-bottom: 16px;
            font-weight: 300;
        }

        .confirm-details {
            font-size: 0.95rem;
            line-height: 1.8;
            opacity: 0.9;
            margin-bottom: 32px;
            font-weight: 300;
        }

        .confirm-btn {
            background: rgba(212, 175, 55, 0.15);
            border: 1px solid var(--gold);
            border-radius: 50px;
            padding: 14px 40px;
            color: var(--gold);
            font-size: 0.95rem;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
        }

        .confirm-btn:active {
            transform: scale(0.95);
            background: rgba(212, 175, 55, 0.25);
        }

        /* Cancel button */
        .cancel-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(10, 22, 40, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 50%;
            color: var(--gold);
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .cancel-btn:active {
            transform: scale(0.9);
            background: rgba(10, 22, 40, 0.95);
        }

        canvas { display: none; }
    </style>
</head>
<body>
    <!-- Start Screen -->
    <div class="start-screen" id="startScreen">
        <div class="start-logo">üìç</div>
        <h1 class="start-title">Service Request</h1>
        <p class="start-subtitle">
            Allow camera & location so staff know exactly where you are - you get fast, precise service. No data stored, ever.
        </p>
        <button class="start-btn" onclick="startExperience()">Begin</button>
        <p class="permission-note">
            Your browser will ask for camera and location access<br>
            <small>Used only for this request ‚Ä¢ Not tracked ‚Ä¢ Fully private</small>
        </p>
    </div>

    <!-- Camera View -->
    <div id="camera-container">
        <video id="video" autoplay playsinline></video>
        
        <div class="camera-overlay"></div>
        
        <div class="location-marker">
            <div class="marker-ring"></div>
            <div class="marker-ring"></div>
            <div class="marker-ring"></div>
            <div class="marker-center"></div>
        </div>

        <div class="location-info">
            <div class="location-status">
                <span class="status-dot"></span>
                <span id="locationText">Acquiring precise location...</span>
            </div>
            <div class="coords" id="coordsText"></div>
        </div>

        <button class="cancel-btn" onclick="cancelRequest()">‚úï</button>

        <!-- Category Selection -->
        <div class="bottom-sheet" id="categorySheet">
            <div class="sheet-handle"></div>
            <div class="sheet-content">
                <h2 class="sheet-title">What can we bring you?</h2>
                <p class="sheet-subtitle">Select a category to see personalized recommendations</p>

                <div class="category-grid">
                    <div class="category-card" onclick="selectCategory('drinks')">
                        <div class="category-icon">üç∏</div>
                        <div class="category-name">Drinks</div>
                    </div>
                    <div class="category-card" onclick="selectCategory('food')">
                        <div class="category-icon">üçΩÔ∏è</div>
                        <div class="category-name">Food</div>
                    </div>
                    <div class="category-card" onclick="selectCategory('transport')">
                        <div class="category-icon">üöó</div>
                        <div class="category-name">Transport</div>
                    </div>
                    <div class="category-card" onclick="selectCategory('service')">
                        <div class="category-icon">üîî</div>
                        <div class="category-name">Service</div>
                    </div>
                    <div class="category-card" onclick="selectCategory('amenities')">
                        <div class="category-icon">üèñÔ∏è</div>
                        <div class="category-name">Amenities</div>
                    </div>
                    <div class="category-card" onclick="selectCategory('other')">
                        <div class="category-icon">‚ú®</div>
                        <div class="category-name">Other</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recommendations View -->
        <div class="bottom-sheet visible" id="recommendationsSheet">
            <div class="sheet-handle"></div>
            <div class="sheet-content">
                <div class="recommendations-view" id="recommendationsView">
                    <button class="back-button" onclick="backToCategories()">
                        ‚Üê Back to categories
                    </button>

                    <div class="context-banner">
                        <div class="context-label">Smart Recommendations</div>
                        <div class="context-value" id="contextDescription"></div>
                    </div>

                    <div class="section-title">Recommended for You</div>
                    <div id="recommendationsList"></div>

                    <div class="section-title">All Options</div>
                    <div id="allOptionsList"></div>

                    <!-- Details Form -->
                    <div class="details-form" id="detailsForm" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">Quantity</label>
                            <div class="quantity-selector">
                                <button class="qty-btn" onclick="changeQuantity(-1)">‚àí</button>
                                <div class="qty-value" id="quantityValue">1</div>
                                <button class="qty-btn" onclick="changeQuantity(1)">+</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Special Requests</label>
                            <textarea class="form-textarea" id="notesInput" placeholder="e.g., Extra ice, no sugar, specific preferences..."></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Dietary Preferences</label>
                            <div class="dietary-tags">
                                <div class="dietary-tag" onclick="toggleDietary(this, 'vegetarian')">Vegetarian</div>
                                <div class="dietary-tag" onclick="toggleDietary(this, 'vegan')">Vegan</div>
                                <div class="dietary-tag" onclick="toggleDietary(this, 'gluten-free')">Gluten-Free</div>
                                <div class="dietary-tag" onclick="toggleDietary(this, 'dairy-free')">Dairy-Free</div>
                                <div class="dietary-tag" onclick="toggleDietary(this, 'allergies')">Allergies</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">When would you like this?</label>
                            <div class="timing-grid">
                                <button class="timing-btn selected" onclick="selectTiming(this, 'now')">Now</button>
                                <button class="timing-btn" onclick="selectTiming(this, '15min')">15 Minutes</button>
                                <button class="timing-btn" onclick="selectTiming(this, '30min')">30 Minutes</button>
                                <button class="timing-btn" onclick="selectTiming(this, 'custom')">Custom Time</button>
                                <input type="time" class="form-input time-input" id="customTime" style="display: none;">
                            </div>
                        </div>

                        <button class="primary-btn" onclick="submitRequest()">
                            Confirm Request
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Screen -->
    <div class="confirmation-screen" id="confirmationScreen">
        <div class="confirmation-content">
            <div class="check-circle">‚úì</div>
            <h2 class="confirm-title">Request Received</h2>
            <div class="confirm-details" id="confirmationDetails"></div>
            <button class="confirm-btn" onclick="closeConfirmation()">Done</button>
        </div>
    </div>

    <canvas id="photoCanvas"></canvas>

    <script>
        // Configuration
        const CONFIG = {
            getApiBaseUrl: () => {
                if (window.location.hostname === 'localhost') return 'http://localhost:3000';
                return 'https://your-api-url.railway.app';
            }
        };

        // Smart recommendations based on context
        const RECOMMENDATIONS = {
            drinks: {
                poolside_morning: [
                    { name: 'Fresh Juice Selection', badge: 'Popular', reason: 'Perfect for poolside mornings' },
                    { name: 'Iced Coffee & Cold Brew', badge: 'Refreshing', reason: 'Cool start to your day' },
                    { name: 'Mimosa & Bellini Bar', reason: 'Brunch favorites' }
                ],
                poolside_afternoon: [
                    { name: 'Frozen Cocktails', badge: 'Recommended', reason: 'Perfect for sunny afternoons' },
                    { name: 'Premium Ros√© Selection', badge: 'Popular', reason: 'Light and refreshing' },
                    { name: 'Craft Beer & Cider', reason: 'Ice-cold selection' }
                ],
                suite_evening: [
                    { name: 'Champagne Service', badge: 'Premium', reason: 'Celebrate in style' },
                    { name: 'Signature Cocktails', badge: 'Curated', reason: 'Handcrafted by our mixologists' },
                    { name: 'Fine Wine Selection', reason: 'Sommelier recommendations' }
                ],
                default: [
                    { name: 'Champagne & Sparkling', badge: 'Premium', reason: 'Elegant choice' },
                    { name: 'Cocktails', reason: 'Handcrafted selections' },
                    { name: 'Wine Selection', reason: 'Curated by our sommelier' }
                ],
                all: ['Champagne', 'Cocktails', 'Wine', 'Beer & Cider', 'Spirits', 'Soft Drinks', 'Coffee & Tea', 'Fresh Juices']
            },
            food: {
                poolside_morning: [
                    { name: 'Continental Breakfast', badge: 'Popular', reason: 'Light poolside dining' },
                    { name: 'Fresh Fruit Platter', badge: 'Healthy', reason: 'Refreshing start' },
                    { name: 'Acai Bowls & Smoothies', reason: 'Energizing options' }
                ],
                poolside_afternoon: [
                    { name: 'Club Sandwiches', badge: 'Classic', reason: 'Perfect poolside lunch' },
                    { name: 'Fresh Salads', badge: 'Light', reason: 'Crisp and refreshing' },
                    { name: 'Sharing Platters', reason: 'Great for groups' }
                ],
                suite_evening: [
                    { name: 'Charcuterie & Cheese Board', badge: 'Premium', reason: 'Perfect with drinks' },
                    { name: 'Canap√©s Selection', reason: 'Elegant appetizers' },
                    { name: 'Dessert Experience', reason: 'Sweet indulgence' }
                ],
                default: [
                    { name: 'Light Bites & Snacks', badge: 'Quick', reason: 'Ready in minutes' },
                    { name: 'Seasonal Salads', reason: 'Fresh ingredients' },
                    { name: 'Sandwiches & Wraps', reason: 'Classic favorites' }
                ],
                all: ['Breakfast Items', 'Light Snacks', 'Sandwiches', 'Salads', 'Sharing Platters', 'Desserts', 'Custom Order']
            },
            transport: {
                default: [
                    { name: 'Airport Transfer', badge: 'Premium', reason: 'Luxury vehicles available' },
                    { name: 'City Tour', reason: 'Curated experiences' },
                    { name: 'Restaurant Reservations', reason: 'We arrange everything' }
                ],
                all: ['Airport Transfer', 'Restaurant Booking', 'City Tours', 'Event Transport', 'Custom Journey']
            },
            service: {
                default: [
                    { name: 'Concierge Assistance', badge: 'Available 24/7', reason: 'Always here to help' },
                    { name: 'Housekeeping', reason: 'Refresh your space' },
                    { name: 'Spa Booking', reason: 'Relaxation awaits' }
                ],
                all: ['Concierge', 'Housekeeping', 'Spa Services', 'Laundry', 'Special Requests']
            },
            amenities: {
                poolside: [
                    { name: 'Fresh Towels', badge: 'Quick', reason: 'Delivered immediately' },
                    { name: 'Sunscreen & Essentials', reason: 'Stay protected' },
                    { name: 'Reading Materials', reason: 'Magazines & books' }
                ],
                default: [
                    { name: 'Towels & Linens', reason: 'Fresh and crisp' },
                    { name: 'Amenity Kit', reason: 'Luxury essentials' },
                    { name: 'Entertainment Setup', reason: 'Books, games, more' }
                ],
                all: ['Towels', 'Toiletries', 'Reading Materials', 'Entertainment', 'Other Amenities']
            },
            other: {
                default: [
                    { name: 'Custom Request', badge: 'We\'ll arrange it', reason: 'Just ask' }
                ],
                all: ['Custom Request']
            }
        };

        // State
        let stream = null;
        let userLocation = null;
        let selectedCategory = null;
        let selectedItem = null;
        let quantity = 1;
        let timing = 'now';
        let dietaryPrefs = [];
        const params = new URLSearchParams(window.location.search);
        const restaurantId = params.get('restaurant') || 'demo-hotel';
        const tableNumber = params.get('table') || 'suite-101';

        // Start experience
        async function startExperience() {
            console.log('Start experience clicked');
            try {
                document.getElementById('startScreen').style.display = 'none';
                document.getElementById('camera-container').classList.add('active');
                console.log('Starting camera...');
                await initCamera();
                console.log('Starting location...');
                await getLocation();
                console.log('Showing category sheet...');
                setTimeout(() => {
                    document.getElementById('categorySheet').classList.add('visible');
                }, 500);
            } catch (error) {
                console.error('Start experience error:', error);
                alert('Error starting AR experience: ' + error.message);
                // Show start screen again
                document.getElementById('startScreen').style.display = 'flex';
                document.getElementById('camera-container').classList.remove('active');
            }
        }

        // Camera
        async function initCamera() {
            console.log('Requesting camera access...');
            try {
                // Check if mediaDevices is available
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('Camera API not available. Make sure you are on HTTPS.');
                }
                
                // Try rear camera first (mobile), fallback to any camera (laptop)
                try {
                    stream = await navigator.mediaDevices.getUserMedia({
                        video: { facingMode: 'environment', width: { ideal: 1920 }, height: { ideal: 1080 } }
                    });
                } catch (err) {
                    console.log('Rear camera not available, trying default camera...');
                    // Fallback to any available camera (for laptops)
                    stream = await navigator.mediaDevices.getUserMedia({
                        video: { width: { ideal: 1920 }, height: { ideal: 1080 } }
                    });
                }
                
                console.log('Camera stream acquired');
                document.getElementById('video').srcObject = stream;
                console.log('Video element connected');
            } catch (error) {
                console.error('Camera error:', error);
                let errorMsg = 'Camera access is required for this feature.\n\n';
                
                if (error.name === 'NotAllowedError') {
                    errorMsg += 'üì∑ How to enable:\n\n';
                    errorMsg += '‚Ä¢ Click the camera icon in your address bar\n';
                    errorMsg += '‚Ä¢ Select "Allow" for camera access\n';
                    errorMsg += '‚Ä¢ Refresh the page and try again\n\n';
                    errorMsg += 'On Chrome: Look for üîí or camera icon near the URL';
                } else if (error.name === 'NotFoundError') {
                    errorMsg += 'No camera found on this device.';
                } else if (error.name === 'NotReadableError') {
                    errorMsg += 'Camera is already in use by another application.\nClose other apps using the camera and try again.';
                } else {
                    errorMsg += error.message;
                }
                alert(errorMsg);
                throw error;
            }
        }

        // Location
        async function getLocation() {
            if (!navigator.geolocation) {
                document.getElementById('locationText').textContent = 'Location unavailable';
                return;
            }
            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    userLocation = { latitude: pos.coords.latitude, longitude: pos.coords.longitude, accuracy: pos.coords.accuracy };
                    document.getElementById('locationText').textContent = 'Location acquired';
                    document.getElementById('coordsText').textContent = 
                        `${userLocation.latitude.toFixed(6)}, ${userLocation.longitude.toFixed(6)}`;
                },
                () => {
                    document.getElementById('locationText').textContent = 'Location unavailable';
                }
            );
        }

        // Get context for recommendations
        function getContext() {
            const hour = new Date().getHours();
            const isPoolside = Math.random() > 0.5; // Mock detection
            
            let timeOfDay = 'morning';
            if (hour >= 12 && hour < 17) timeOfDay = 'afternoon';
            else if (hour >= 17) timeOfDay = 'evening';
            
            let locationContext = isPoolside ? 'poolside' : 'suite';
            
            return {
                key: `${locationContext}_${timeOfDay}`,
                description: `${locationContext.charAt(0).toUpperCase() + locationContext.slice(1)} ‚Ä¢ ${timeOfDay.charAt(0).toUpperCase() + timeOfDay.slice(1)}`
            };
        }

        // Select category
        function selectCategory(category) {
            selectedCategory = category;
            const context = getContext();
            const recommendations = RECOMMENDATIONS[category][context.key] || RECOMMENDATIONS[category].default;
            const allOptions = RECOMMENDATIONS[category].all;

            document.getElementById('contextDescription').textContent = context.description;
            
            // Render recommendations
            document.getElementById('recommendationsList').innerHTML = recommendations.map(rec => `
                <div class="recommendation-card" onclick="selectRecommendation('${rec.name}')">
                    <div class="rec-header">
                        <div class="rec-name">${rec.name}</div>
                        ${rec.badge ? `<div class="rec-badge">${rec.badge}</div>` : ''}
                    </div>
                    <div class="rec-reason">${rec.reason}</div>
                </div>
            `).join('');

            // Render all options
            document.getElementById('allOptionsList').innerHTML = allOptions.map(option => `
                <div class="recommendation-card" onclick="selectRecommendation('${option}')">
                    <div class="rec-name">${option}</div>
                </div>
            `).join('');

            document.getElementById('categorySheet').classList.remove('visible');
            document.getElementById('recommendationsSheet').classList.add('visible');
            document.getElementById('recommendationsView').classList.add('visible');
        }

        function backToCategories() {
            document.getElementById('recommendationsView').classList.remove('visible');
            document.getElementById('recommendationsSheet').classList.remove('visible');
            setTimeout(() => {
                document.getElementById('categorySheet').classList.add('visible');
            }, 300);
        }

        function selectRecommendation(item) {
            selectedItem = item;
            document.querySelectorAll('.recommendation-card').forEach(card => {
                card.classList.remove('selected');
                if (card.querySelector('.rec-name').textContent === item) {
                    card.classList.add('selected');
                }
            });
            document.getElementById('detailsForm').style.display = 'block';
            document.getElementById('detailsForm').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function changeQuantity(delta) {
            quantity = Math.max(1, quantity + delta);
            document.getElementById('quantityValue').textContent = quantity;
        }

        function toggleDietary(element, pref) {
            element.classList.toggle('selected');
            if (dietaryPrefs.includes(pref)) {
                dietaryPrefs = dietaryPrefs.filter(p => p !== pref);
            } else {
                dietaryPrefs.push(pref);
            }
        }

        function selectTiming(button, time) {
            document.querySelectorAll('.timing-btn').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            timing = time;
            document.getElementById('customTime').style.display = time === 'custom' ? 'block' : 'none';
        }

        function capturePhoto() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('photoCanvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            return canvas.toDataURL('image/jpeg', 0.8);
        }

        async function submitRequest() {
            const photo = capturePhoto();
            const notes = document.getElementById('notesInput').value;
            const customTime = document.getElementById('customTime').value;

            let scheduledTime = new Date();
            if (timing === '15min') scheduledTime.setMinutes(scheduledTime.getMinutes() + 15);
            else if (timing === '30min') scheduledTime.setMinutes(scheduledTime.getMinutes() + 30);
            else if (timing === 'custom' && customTime) {
                const [h, m] = customTime.split(':');
                scheduledTime.setHours(parseInt(h), parseInt(m));
            }

            const requestData = {
                restaurant_id: restaurantId,
                table_number: tableNumber,
                category: selectedCategory,
                item: selectedItem,
                quantity: quantity,
                notes: notes,
                dietary: dietaryPrefs,
                timing: timing,
                scheduled_time: scheduledTime.toISOString(),
                location: userLocation,
                photo: photo,
                timestamp: new Date().toISOString()
            };

            // Send to backend
            try {
                const response = await fetch(`${CONFIG.getApiBaseUrl()}/api/service/ar-request`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });
            } catch (error) {
                console.log('Demo mode - request logged:', requestData);
            }

            showConfirmation(requestData);
        }

        function showConfirmation(data) {
            if (stream) stream.getTracks().forEach(track => track.stop());
            document.getElementById('camera-container').classList.remove('active');

            let timingText = timing === 'now' ? 'immediately' : 
                           timing === '15min' ? 'in 15 minutes' :
                           timing === '30min' ? 'in 30 minutes' :
                           `at ${document.getElementById('customTime').value}`;

            document.getElementById('confirmationDetails').innerHTML = `
                <strong>${quantity}√ó ${data.item}</strong><br>
                will be delivered ${timingText}<br><br>
                <small>${data.table_number} ‚Ä¢ ${data.category}</small>
            `;
            document.getElementById('confirmationScreen').classList.add('active');
        }

        function closeConfirmation() {
            if (window.opener) window.close();
            else location.reload();
        }

        function cancelRequest() {
            if (confirm('Cancel this request?')) {
                if (stream) stream.getTracks().forEach(track => track.stop());
                if (window.opener) window.close();
                else location.reload();
            }
        }

        window.addEventListener('beforeunload', () => {
            if (stream) stream.getTracks().forEach(track => track.stop());
        });
    </script>
</body>
</html>

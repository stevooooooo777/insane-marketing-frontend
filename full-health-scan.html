<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Success Prediction System</title>
<script src="/config-client.js"></script>
<script>
  window.addEventListener('load', async () => {
    const user = CONFIG.getAuthenticatedUser();
    const analytics = await CONFIG.makeApiCall(`/api/analytics/${user.restaurantId}`);
    document.getElementById('total-scans').textContent = analytics.totalScans || 0;
  });
</script>    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b35 0%, #f7941d 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .branding {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 10px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 0;
            min-height: 600px;
        }

        .input-section {
            padding: 40px;
            background: white;
        }

        .results-section {
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 40px;
            border-left: 1px solid #dee2e6;
        }

        .category {
            margin-bottom: 35px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #007bff;
        }

        .category h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 0.95em;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .score-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .score-value {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .score-label {
            font-size: 1.1em;
            color: #6c757d;
            margin-bottom: 15px;
        }

        .score-bar {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .score-fill {
            height: 100%;
            transition: all 0.8s ease;
            border-radius: 5px;
        }

        .breakdown {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .breakdown h4 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 1.2em;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-name {
            font-weight: 500;
            color: #495057;
        }

        .metric-score {
            font-weight: bold;
            padding: 5px 12px;
            border-radius: 20px;
            color: white;
            font-size: 0.9em;
        }

        .calculate-btn {
            background: linear-gradient(135deg, #ff6b35 0%, #f7941d 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
            margin: 20px 0;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.4);
        }

        .icon {
            font-size: 1.2em;
        }

        .recommendations {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .recommendations h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .recommendation {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #28a745;
        }

        .risk-indicator {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
            text-align: center;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .input-row {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 SME Business Health Scanner</h1>
            <p>Discover exactly where to focus your marketing & growth efforts</p>
            <div class="branding">Powered by insane.marketing</div>
        </div>

        <div class="main-content">
            <div class="input-section">
                <form id="businessForm">
                    <div class="category">
                        <h3><span class="icon">💰</span> Financial Metrics</h3>
                        <div class="input-row">
                            <div class="input-group">
                                <label>Annual Revenue (£)</label>
                                <input type="number" id="revenue" placeholder="1000000">
                            </div>
                            <div class="input-group">
                                <label>Revenue Growth Rate (%)</label>
                                <input type="number" id="revenueGrowth" placeholder="15" step="0.1">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label>Profit Margin (%)</label>
                                <input type="number" id="profitMargin" placeholder="20" step="0.1">
                            </div>
                            <div class="input-group">
                                <label>Cash Flow (£)</label>
                                <input type="number" id="cashFlow" placeholder="200000">
                            </div>
                        </div>
                    </div>

                    <div class="category">
                        <h3><span class="icon">📊</span> Market Position</h3>
                        <div class="input-row">
                            <div class="input-group">
                                <label>Market Share (%)</label>
                                <input type="number" id="marketShare" placeholder="10" step="0.1">
                            </div>
                            <div class="input-group">
                                <label>Customer Acquisition Cost (£)</label>
                                <input type="number" id="cac" placeholder="100">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label>Customer Lifetime Value (£)</label>
                                <input type="number" id="clv" placeholder="1000">
                            </div>
                            <div class="input-group">
                                <label>Market Growth Rate (%)</label>
                                <input type="number" id="marketGrowth" placeholder="8" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div class="category">
                        <h3><span class="icon"⚙️</span> Operations</h3>
                        <div class="input-row">
                            <div class="input-group">
                                <label>Employee Count</label>
                                <input type="number" id="employees" placeholder="50">
                            </div>
                            <div class="input-group">
                                <label>Employee Turnover Rate (%)</label>
                                <input type="number" id="turnover" placeholder="15" step="0.1">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label>Operational Efficiency Score (1-10)</label>
                                <input type="number" id="efficiency" placeholder="7" min="1" max="10">
                            </div>
                            <div class="input-group">
                                <label>Years in Business</label>
                                <input type="number" id="yearsInBusiness" placeholder="5">
                            </div>
                        </div>
                    </div>

                    <div class="category">
                        <h3><span class="icon">👥</span> Customer Metrics</h3>
                        <div class="input-row">
                            <div class="input-group">
                                <label>Customer Satisfaction Score (1-10)</label>
                                <input type="number" id="satisfaction" placeholder="8" min="1" max="10">
                            </div>
                            <div class="input-group">
                                <label>Customer Retention Rate (%)</label>
                                <input type="number" id="retention" placeholder="80" step="0.1">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label>Net Promoter Score (-100 to 100)</label>
                                <input type="number" id="nps" placeholder="50" min="-100" max="100">
                            </div>
                            <div class="input-group">
                                <label>Monthly Active Customers</label>
                                <input type="number" id="activeCustomers" placeholder="1000">
                            </div>
                        </div>
                    </div>

                    <div class="category">
                        <h3><span class="icon">🔬</span> Innovation & Leadership</h3>
                        <div class="input-row">
                            <div class="input-group">
                                <label>R&D Investment (% of revenue)</label>
                                <input type="number" id="rdInvestment" placeholder="5" step="0.1">
                            </div>
                            <div class="input-group">
                                <label>Leadership Experience Score (1-10)</label>
                                <input type="number" id="leadership" placeholder="7" min="1" max="10">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label>Digital Transformation Score (1-10)</label>
                                <input type="number" id="digitalScore" placeholder="6" min="1" max="10">
                            </div>
                            <div class="input-group">
                                <label>Industry Type</label>
                                <select id="industry">
                                    <option value="technology">Technology</option>
                                    <option value="healthcare">Healthcare</option>
                                    <option value="finance">Finance</option>
                                    <option value="retail">Retail</option>
                                    <option value="manufacturing">Manufacturing</option>
                                    <option value="services">Services</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <button type="button" class="calculate-btn" onclick="calculateSuccess()">
                        Calculate Success Probability
                    </button>
                </form>
            </div>

            <div class="results-section">
                <div class="score-card">
                    <div class="score-value" id="overallScore">-</div>
                    <div class="score-label">Success Probability</div>
                    <div class="score-bar">
                        <div class="score-fill" id="scoreFill"></div>
                    </div>
                    <div id="riskIndicator" class="risk-indicator"></div>
                </div>

                <div class="breakdown">
                    <h4>📈 Detailed Breakdown</h4>
                    <div class="metric">
                        <span class="metric-name">Financial Health</span>
                        <span class="metric-score" id="financialScore">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-name">Market Position</span>
                        <span class="metric-score" id="marketScore">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-name">Operational Excellence</span>
                        <span class="metric-score" id="operationalScore">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-name">Customer Loyalty</span>
                        <span class="metric-score" id="customerScore">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-name">Innovation & Leadership</span>
                        <span class="metric-score" id="innovationScore">-</span>
                    </div>
                </div>

                <div class="recommendations" id="recommendations">
                    <h4>💡 Key Recommendations</h4>
                    <div id="recommendationsList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function calculateSuccess() {
            // Get all input values
            const data = {
                revenue: parseFloat(document.getElementById('revenue').value) || 0,
                revenueGrowth: parseFloat(document.getElementById('revenueGrowth').value) || 0,
                profitMargin: parseFloat(document.getElementById('profitMargin').value) || 0,
                cashFlow: parseFloat(document.getElementById('cashFlow').value) || 0,
                marketShare: parseFloat(document.getElementById('marketShare').value) || 0,
                cac: parseFloat(document.getElementById('cac').value) || 0,
                clv: parseFloat(document.getElementById('clv').value) || 0,
                marketGrowth: parseFloat(document.getElementById('marketGrowth').value) || 0,
                employees: parseFloat(document.getElementById('employees').value) || 0,
                turnover: parseFloat(document.getElementById('turnover').value) || 0,
                efficiency: parseFloat(document.getElementById('efficiency').value) || 0,
                yearsInBusiness: parseFloat(document.getElementById('yearsInBusiness').value) || 0,
                satisfaction: parseFloat(document.getElementById('satisfaction').value) || 0,
                retention: parseFloat(document.getElementById('retention').value) || 0,
                nps: parseFloat(document.getElementById('nps').value) || 0,
                activeCustomers: parseFloat(document.getElementById('activeCustomers').value) || 0,
                rdInvestment: parseFloat(document.getElementById('rdInvestment').value) || 0,
                leadership: parseFloat(document.getElementById('leadership').value) || 0,
                digitalScore: parseFloat(document.getElementById('digitalScore').value) || 0,
                industry: document.getElementById('industry').value
            };

            // Calculate individual scores
            const scores = calculateIndividualScores(data);
            
            // Calculate overall success probability
            const overallScore = calculateOverallScore(scores, data);
            
            // Update UI
            updateResults(overallScore, scores, data);
        }

        function calculateIndividualScores(data) {
            const scores = {};

            // Financial Health Score (0-100)
            let financialScore = 0;
            if (data.profitMargin > 0) financialScore += Math.min(data.profitMargin * 2, 30);
            if (data.revenueGrowth > 0) financialScore += Math.min(data.revenueGrowth * 1.5, 25);
            if (data.cashFlow > 0) financialScore += Math.min((data.cashFlow / data.revenue) * 100, 25);
            if (data.revenue > 100000) financialScore += Math.min(Math.log10(data.revenue / 100000) * 5, 20);
            scores.financial = Math.min(financialScore, 100);

            // Market Position Score (0-100)
            let marketScore = 0;
            if (data.marketShare > 0) marketScore += Math.min(data.marketShare * 3, 30);
            if (data.clv > data.cac && data.cac > 0) marketScore += Math.min((data.clv / data.cac) * 10, 25);
            if (data.marketGrowth > 0) marketScore += Math.min(data.marketGrowth * 2, 20);
            marketScore += Math.min(Math.log10(data.activeCustomers || 1) * 5, 25);
            scores.market = Math.min(marketScore, 100);

            // Operational Excellence Score (0-100)
            let operationalScore = 0;
            operationalScore += data.efficiency * 10;
            operationalScore += Math.max(0, 100 - data.turnover * 2);
            operationalScore += Math.min(data.yearsInBusiness * 5, 30);
            if (data.employees > 0) operationalScore += Math.min(Math.log10(data.employees) * 10, 20);
            scores.operational = Math.min(operationalScore / 3, 100);

            // Customer Loyalty Score (0-100)
            let customerScore = 0;
            customerScore += data.satisfaction * 10;
            customerScore += Math.min(data.retention, 100);
            customerScore += Math.max(0, (data.nps + 100) / 2);
            scores.customer = Math.min(customerScore / 3, 100);

            // Innovation & Leadership Score (0-100)
            let innovationScore = 0;
            innovationScore += data.leadership * 10;
            innovationScore += data.digitalScore * 10;
            innovationScore += Math.min(data.rdInvestment * 4, 30);
            
            // Industry multiplier
            const industryMultipliers = {
                technology: 1.2,
                healthcare: 1.1,
                finance: 1.0,
                retail: 0.9,
                manufacturing: 0.95,
                services: 1.0,
                other: 1.0
            };
            innovationScore *= (industryMultipliers[data.industry] || 1.0);
            scores.innovation = Math.min(innovationScore / 3, 100);

            return scores;
        }

        function calculateOverallScore(scores, data) {
            // Weighted average of all scores
            const weights = {
                financial: 0.25,
                market: 0.25,
                operational: 0.20,
                customer: 0.20,
                innovation: 0.10
            };

            let weightedSum = 0;
            let totalWeight = 0;

            for (const [category, score] of Object.entries(scores)) {
                if (!isNaN(score) && score > 0) {
                    weightedSum += score * weights[category];
                    totalWeight += weights[category];
                }
            }

            const baseScore = totalWeight > 0 ? weightedSum / totalWeight : 0;
            
            // Apply bonus factors
            let bonusMultiplier = 1.0;
            
            // Profitability bonus
            if (data.profitMargin > 15) bonusMultiplier += 0.05;
            
            // Growth bonus
            if (data.revenueGrowth > 20) bonusMultiplier += 0.05;
            
            // Customer loyalty bonus
            if (data.retention > 85 && data.nps > 50) bonusMultiplier += 0.05;
            
            // Market position bonus
            if (data.marketShare > 15) bonusMultiplier += 0.03;

            return Math.min(baseScore * bonusMultiplier, 100);
        }

        function updateResults(overallScore, scores, data) {
            // Update overall score
            document.getElementById('overallScore').textContent = Math.round(overallScore) + '%';
            
            // Update score bar
            const scoreFill = document.getElementById('scoreFill');
            scoreFill.style.width = overallScore + '%';
            
            // Color based on score
            let color;
            if (overallScore >= 80) color = '#28a745';
            else if (overallScore >= 60) color = '#ffc107';
            else if (overallScore >= 40) color = '#fd7e14';
            else color = '#dc3545';
            
            scoreFill.style.backgroundColor = color;

            // Update individual scores
            updateScoreElement('financialScore', scores.financial, color);
            updateScoreElement('marketScore', scores.market, color);
            updateScoreElement('operationalScore', scores.operational, color);
            updateScoreElement('customerScore', scores.customer, color);
            updateScoreElement('innovationScore', scores.innovation, color);

            // Update risk indicator
            updateRiskIndicator(overallScore);

            // Update recommendations
            updateRecommendations(scores, data, overallScore);
        }

        function updateScoreElement(elementId, score, color) {
            const element = document.getElementById(elementId);
            element.textContent = Math.round(score) + '%';
            element.style.backgroundColor = color;
        }

        function updateRiskIndicator(score) {
            const indicator = document.getElementById('riskIndicator');
            
            if (score >= 80) {
                indicator.textContent = '🟢 Low Risk - High Success Probability';
                indicator.style.backgroundColor = '#d4edda';
                indicator.style.color = '#155724';
                indicator.style.border = '2px solid #28a745';
            } else if (score >= 60) {
                indicator.textContent = '🟡 Moderate Risk - Good Potential';
                indicator.style.backgroundColor = '#fff3cd';
                indicator.style.color = '#856404';
                indicator.style.border = '2px solid #ffc107';
            } else if (score >= 40) {
                indicator.textContent = '🟠 High Risk - Needs Improvement';
                indicator.style.backgroundColor = '#f8d7da';
                indicator.style.color = '#721c24';
                indicator.style.border = '2px solid #fd7e14';
            } else {
                indicator.textContent = '🔴 Very High Risk - Major Concerns';
                indicator.style.backgroundColor = '#f8d7da';
                indicator.style.color = '#721c24';
                indicator.style.border = '2px solid #dc3545';
            }
        }

        function updateRecommendations(scores, data, overallScore) {
            const recommendationsList = document.getElementById('recommendationsList');
            const recommendations = generateRecommendations(scores, data, overallScore);
            
            recommendationsList.innerHTML = '';
            recommendations.forEach(rec => {
                const div = document.createElement('div');
                div.className = 'recommendation';
                div.textContent = rec;
                recommendationsList.appendChild(div);
            });
        }

        function generateRecommendations(scores, data, overallScore) {
            const recommendations = [];

            // Marketing-focused recommendations for SMEs
            if (scores.financial < 60) {
                if (data.profitMargin < 15) {
                    recommendations.push('💰 Implement value-based pricing strategy - you may be undercharging for your services');
                }
                if (data.revenueGrowth < 15) {
                    recommendations.push('📈 Launch targeted digital marketing campaigns to accelerate customer acquisition');
                }
                if (data.cashFlow < data.revenue * 0.15) {
                    recommendations.push('💳 Offer payment incentives for early payments or consider subscription models');
                }
            }

            // Market & marketing recommendations
            if (scores.market < 60) {
                if (data.cac > 0 && data.clv / data.cac < 3) {
                    recommendations.push('🎯 Focus on higher-value customers - your marketing spend isn\'t generating enough return');
                }
                if (data.marketShare < 8) {
                    recommendations.push('🌐 Build stronger online presence through SEO, content marketing, and social media');
                }
                if (data.activeCustomers < 500) {
                    recommendations.push('📱 Implement referral programs and customer advocacy initiatives');
                }
            }

            // Operational recommendations for SMEs
            if (scores.operational < 60) {
                if (data.turnover > 25) {
                    recommendations.push('👥 Invest in team culture and competitive compensation to reduce hiring costs');
                }
                if (data.efficiency < 6) {
                    recommendations.push('⚡ Automate repetitive tasks - consider CRM, email marketing, and scheduling tools');
                }
                if (data.yearsInBusiness < 3) {
                    recommendations.push('🏗️ Focus on building systems and processes for sustainable growth');
                }
            }

            // Customer & marketing alignment
            if (scores.customer < 60) {
                if (data.satisfaction < 7) {
                    recommendations.push('⭐ Survey customers to identify service gaps - happy customers are your best marketing');
                }
                if (data.retention < 70) {
                    recommendations.push('🔄 Create customer success programs and regular check-ins to prevent churn');
                }
                if (data.nps < 30) {
                    recommendations.push('💬 Implement feedback loops and testimonial collection for social proof');
                }
            }

            // Innovation & digital marketing
            if (scores.innovation < 60) {
                if (data.digitalScore < 6) {
                    recommendations.push('🚀 Modernize your digital presence - website, social media, and online reviews');
                }
                if (data.rdInvestment < 2) {
                    recommendations.push('💡 Allocate budget for testing new marketing channels and growth experiments');
                }
            }

            // SME-specific overall recommendations
            if (overallScore < 50) {
                recommendations.push('📊 Start with marketing analytics - track what works before scaling spending');
                recommendations.push('🤝 Network actively in your industry - B2B referrals are gold for SMEs');
            } else if (overallScore > 75) {
                recommendations.push('🔥 You\'re doing great! Consider expanding to new markets or customer segments');
                recommendations.push('📢 Document your success story for case studies and thought leadership');
            }

            // Add marketing-specific insights
            if (data.employees < 20) {
                recommendations.push('⚖️ Focus on high-impact, low-maintenance marketing: email, content, and partnerships');
            }

            return recommendations.slice(0, 7); // Show more recommendations for SMEs
        }

        // Initialize with sample data
        window.onload = function() {
            // You can pre-populate with sample data for demonstration
            document.getElementById('revenue').value = '2500000';
            document.getElementById('revenueGrowth').value = '18';
            document.getElementById('profitMargin').value = '22';
            document.getElementById('cashFlow').value = '350000';
            document.getElementById('marketShare').value = '12';
            document.getElementById('cac').value = '150';
            document.getElementById('clv').value = '1200';
            document.getElementById('marketGrowth').value = '9';
            document.getElementById('employees').value = '75';
            document.getElementById('turnover').value = '12';
            document.getElementById('efficiency').value = '8';
            document.getElementById('yearsInBusiness').value = '7';
            document.getElementById('satisfaction').value = '8.5';
            document.getElementById('retention').value = '82';
            document.getElementById('nps').value = '45';
            document.getElementById('activeCustomers').value = '2500';
            document.getElementById('rdInvestment').value = '6';
            document.getElementById('leadership').value = '8';
            document.getElementById('digitalScore').value = '7';
            
            // Auto-calculate with sample data
            calculateSuccess();
        };
    </script>
</body>
</html>
